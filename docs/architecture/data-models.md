# Data Models

The core data models represent the business entities shared between frontend and backend, designed to support the multi-agent pipeline and complex itinerary relationships. These models enable type safety across the entire stack while accommodating the rich data structures generated by AI agents.

## User

**Purpose:** Represents authenticated users with their travel preferences and persona selections, enabling personalized recommendations and itinerary ownership.

**Key Attributes:**
- id: string (UUID) - Primary identifier from Supabase Auth
- email: string - User's email address for magic link authentication
- name: string | null - Optional display name for personalization
- preferences: UserPreferences - Stored travel preferences and persona history
- createdAt: Date - Account creation timestamp
- lastActiveAt: Date - Session tracking for engagement analytics

### TypeScript Interface

```typescript
interface User {
  id: string;
  email: string;
  name: string | null;
  preferences: UserPreferences;
  createdAt: Date;
  lastActiveAt: Date;
}

interface UserPreferences {
  defaultPersona: PersonaType | null;
  budgetRange: BudgetRange;
  accessibilityNeeds: string[];
  dietaryRestrictions: string[];
  travelStyle: 'relaxed' | 'packed' | 'balanced';
  preferredActivities: ActivityType[];
}

type PersonaType = 'photography' | 'food-forward' | 'architecture' | 'family';
type BudgetRange = 'budget' | 'mid-range' | 'luxury' | 'no-limit';
```

### Relationships
- One-to-many with Itinerary (user owns multiple itineraries)
- One-to-many with ItineraryRequest (tracks all generation attempts)

## Itinerary

**Purpose:** Represents a complete weekend travel plan generated by the multi-agent system, containing all activities, logistics, and metadata for a specific trip.

**Key Attributes:**
- id: string (UUID) - Primary identifier
- userId: string - Foreign key to User
- destination: Destination - Target location with geographic data
- persona: PersonaType - Applied persona lens for curation
- status: ItineraryStatus - Processing and completion state
- activities: Activity[] - Ordered list of recommended activities
- metadata: ItineraryMetadata - Processing details and quality metrics
- createdAt: Date - Generation timestamp
- updatedAt: Date - Last modification timestamp

### TypeScript Interface

```typescript
interface Itinerary {
  id: string;
  userId: string;
  destination: Destination;
  persona: PersonaType;
  status: ItineraryStatus;
  activities: Activity[];
  metadata: ItineraryMetadata;
  createdAt: Date;
  updatedAt: Date;
}

interface Destination {
  name: string;
  city: string;
  region: string;
  country: string;
  coordinates: {
    lat: number;
    lng: number;
  };
  timeZone: string;
}

type ItineraryStatus = 'processing' | 'completed' | 'failed' | 'archived';

interface ItineraryMetadata {
  processingTimeSeconds: number;
  agentVersions: AgentVersions;
  qualityScore: number;
  validationResults: ValidationResults;
  costEstimate: CostEstimate;
}
```

### Relationships
- Belongs-to User (foreign key: userId)
- One-to-many with Activity (embedded array)
- One-to-one with ItineraryRequest (generation context)

## Activity

**Purpose:** Individual recommendation within an itinerary, containing rich context from curation agents and validation results from external APIs.

**Key Attributes:**
- id: string (UUID) - Primary identifier
- itineraryId: string - Foreign key to parent Itinerary
- name: string - Activity title
- description: string - Rich narrative description from curation agent
- category: ActivityCategory - Classification for filtering and organization
- timing: ActivityTiming - Schedule and duration information
- location: ActivityLocation - Geographic and venue details
- validation: ValidationResult - External API verification status
- personaContext: PersonaContext - Persona-specific reasoning and highlights

### TypeScript Interface

```typescript
interface Activity {
  id: string;
  itineraryId: string;
  name: string;
  description: string;
  category: ActivityCategory;
  timing: ActivityTiming;
  location: ActivityLocation;
  validation: ValidationResult;
  personaContext: PersonaContext;
}

type ActivityCategory = 
  | 'dining' 
  | 'sightseeing' 
  | 'culture' 
  | 'nature' 
  | 'shopping' 
  | 'nightlife' 
  | 'transport';

interface ActivityTiming {
  dayNumber: number; // 1-based day within itinerary
  startTime: string; // ISO time string
  duration: number; // minutes
  flexibility: 'fixed' | 'flexible' | 'weather-dependent';
  bufferTime: number; // minutes for transitions
}

interface ActivityLocation {
  name: string;
  address: string;
  coordinates: {
    lat: number;
    lng: number;
  };
  neighborhood: string;
  googlePlaceId: string | null;
  accessibility: AccessibilityInfo;
}
```

### Relationships
- Belongs-to Itinerary (foreign key: itineraryId)
- References Google Places API data (via googlePlaceId)

## ItineraryRequest

**Purpose:** Captures the original user requirements and tracks the multi-agent processing pipeline for debugging, analytics, and improvement.

**Key Attributes:**
- id: string (UUID) - Primary identifier
- userId: string - Foreign key to User
- itineraryId: string | null - Foreign key to resulting Itinerary (null if failed)
- requirements: UserRequirements - Original user input and preferences
- processingLog: AgentProcessingLog[] - Detailed pipeline execution trace
- status: ProcessingStatus - Current state in the agent pipeline
- errorDetails: ProcessingError | null - Failure information if applicable

### TypeScript Interface

```typescript
interface ItineraryRequest {
  id: string;
  userId: string;
  itineraryId: string | null;
  requirements: UserRequirements;
  processingLog: AgentProcessingLog[];
  status: ProcessingStatus;
  errorDetails: ProcessingError | null;
  createdAt: Date;
  updatedAt: Date;
}

interface UserRequirements {
  destination: string;
  persona: PersonaType;
  dates: {
    startDate: Date;
    endDate: Date;
  };
  budgetRange: BudgetRange;
  groupSize: number;
  specialRequests: string[];
  accessibilityNeeds: string[];
}

type ProcessingStatus = 
  | 'initiated' 
  | 'research-in-progress' 
  | 'research-completed'
  | 'curation-in-progress'
  | 'curation-completed'
  | 'validation-in-progress'
  | 'validation-completed'
  | 'response-in-progress'
  | 'completed'
  | 'failed';
```

### Relationships
- Belongs-to User (foreign key: userId)
- One-to-one with Itinerary (foreign key: itineraryId, nullable)
